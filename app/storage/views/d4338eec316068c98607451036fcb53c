
<?php $__env->startSection('head'); ?>

<?php echo HTML::style('/css/redactor.css'); ?>
<?php echo HTML::style('/css/redactor.bootstrap.css'); ?>
<?php echo HTML::script('/js/redactor.min.js'); ?>

<?php echo HTML::style('/css/bootstrap-fileupload.min.css'); ?>
<?php echo HTML::script('/js/bootstrap-fileupload.min.js'); ?>

<style type="text/css">

	.image-container {
		text-align: center;
		margin-right: 7px;
		width: 165px;
		overflow: hidden;
	}
	
	.image-container .thumbnail {
		width: 155px;
		height: 155px;
		background: #efefef;
	}
	
	.image-container .btn-file {
		width: 95px;
	}
	
	#add-image-btn {
		cursor: pointer;
	}
	
	#add-image-btn .thumbnail {
		width: 155px;
		height: 155px;
		background: #efefef;
		text-align: center;
	}
	
	#add-image-btn .thumbnail i {
		 font-size: 50px;
		 line-height: 155px;
		 color: #ccc;
	}
</style>

<script type="text/javascript">

var icid = 1;

$(document).ready(function(){


	
});


$(function(){
	$('#redactor_content').redactor({
		imageUpload: '/projects/imageupload',
		//fileUpload: '/projects/fileupload',
		//imageGetJson: '/projects/getjson',
		//linebreaks: true,
		paragraphy: false,
		toolbarFixed: true,
		toolbarFixedTopOffset: 75, 
		buttons: ['bold', 'italic', 'underline', '|',
'unorderedlist', 'orderedlist', 'outdent', 'indent', '|', 'html' ],
		wym: true,
	    allowedTags: ['p', 'b', 'strong', 'i', 'u', 'ul', 'ol', 'li', 'dl', 'dt', 'dd'],

		//formattingTags: ['h2', 'h3', 'p' ],
		langs: {
				en: {
					html: 'HTML',
					video: 'Insert Video',
					image: 'Insert Image',
					link: 'Link',
					link_insert: 'Insert link',
					unlink: 'Unlink',
					formatting: 'Formatting',
					paragraph: 'Normal text',
					quote: 'Quote',
					code: 'Code',
					header2: 'Section',
					header3: 'Heading',
					bold: 'Bold',
					italic: 'Italic',
					unorderedlist: 'Unordered List',
					orderedlist: 'Ordered List',
					outdent: 'Outdent',
					indent: 'Indent',
					cancel: 'Cancel',
					insert: 'Insert',
					save: 'Save',
					_delete: 'Delete',
					rows: 'Rows',
					columns: 'Columns',
					add_head: 'Add Head',
					delete_head: 'Delete Head',
					title: 'Title',
					image_position: 'Position',
					none: 'None',
					left: 'Left',
					right: 'Right',
					image_web_link: 'Image Web Link',
					text: 'Text',
					mailto: 'Email',
					web: 'URL',
					video_html_code: 'Video Embed Code',
					file: 'Insert File',
					upload: 'Upload',
					download: 'Download',
					choose: 'Choose',
					or_choose: 'Or choose',
					drop_file_here: 'Drop file here',
					align_left: 'Align text to the left',
					align_center: 'Center text',
					align_right: 'Align text to the right',
					align_justify: 'Justify text',
					horizontalrule: 'Add Section',
					deleted: 'Deleted',
					anchor: 'Anchor',
					link_new_tab: 'Open link in new tab',
					underline: 'Underline',
					alignment: 'Alignment',
					filename: 'Name (optional)',
				}
		},
		
	});
});


function delete_project() {
	bootbox.confirm("<h3>Do you really want to delete this project?</h3>", function(result) {
		if (result) {
			$("form").attr("action", "/projects/delete");
			$("form").submit();
		}
	}); 
}


function remove_image(id) {
	$(id).parent().remove();
/*
	$('#icid-' + id).fileupload('clear');
	$('#icid-' + id).remove();
	*/
}

function remove_image2(id) {
	$(id).parent().remove();
}

function add_image() {
	var output = "";
	output += '<div class="pull-left image-container">';
	output += '<div class="fileupload fileupload-new" data-provides="fileupload">';
	output += '<div class="fileupload-new thumbnail"></div>';
	output += '<div class="fileupload-preview fileupload-exists thumbnail"></div>';
	output += '<br />';
	output += '<span class="btn btn-file"><span class="fileupload-new">Select</span><span class="fileupload-exists">Change</span><input type="file" name="file[]" /></span>';
	output += ' <button type="button" onclick="remove_image(this);" class="btn btn-danger"><i class="icon-remove"></i></button>';
	output += '</div>';
	output += '</div>';
	$('#add-image-btn').before(output);
	icid++;
}

</script>
        
<?php $__env->stopSection(); ?>

<?php
/*
<?php $__env->startSection('page_header'); ?>
	<i class="icon-book"></i> <a href="/projects">Projects</a> <i class="icon-angle-right"></i> Create new project
<?php $__env->stopSection(); ?>
*/
?>

<?php $__env->startSection('content'); ?>
<?php echo Form::open(array('enctype' => "multipart/form-data")); ?>


<?php echo (isset($project)) ? Form::hidden('_id', $project->id) : ''; ?>

<h1>Your project</h1>

<div class="well">
	<div class="row">
		<div class="span11">
			<h3>What is the title of your project?</h3>
			<fieldset>
				<?php echo Form::text('title', (isset($project)) ? $project->title : '' , array(
					'placeholder' => 'Title',
					'class' => 'span11',
				));; ?>
				<?php echo ($errors->first('title')) ? '<p class="alert alert-error">Please provide a title</p>': ''; ?>
			</fieldset>
			
			<h3>How does it look like?</h3>
			<?php if (isset($project)): ?>
				<?php
				$files = array();
				if ($project->files != "") $files = explode(',', $project->files);
				?>
				<?php foreach ($files as $file): ?>
				<div class="pull-left image-container">
					<div class="fileupload">
						<div class="fileupload-new thumbnail">
							<img src="<?php echo $file; ?>" />
							<br />
						</div>
						<input type="hidden" name="existing_file[]" value="<?php echo $file; ?>" />
						<button type="button" onclick="remove_image(this);" class="btn btn-danger"><i class="icon-remove"></i></button>
					</div>
				</div>
				<?php endforeach; ?>
			<?php endif; ?>

			<?php if (!isset($project)): ?>
			<div class="pull-left image-container">
				<div class="fileupload fileupload-new" data-provides="fileupload">
					<div class="fileupload-new thumbnail"></div>
					<div class="fileupload-preview fileupload-exists thumbnail"></div>
					<br />
					<span class="btn btn-file"><span class="fileupload-new">Select</span><span class="fileupload-exists">Change</span><input type="file" name="file[]" /></span>
					<button type="button" onclick="remove_image(this);" class="btn btn-danger"><i class="icon-remove"></i></button>

				</div>
			</div>
			<?php endif; ?>
			<div class="pull-left" id="add-image-btn">
				<div class="thumbnail" onclick="add_image();">
					<i class="icon-plus"></i>
				</div>
			
			</div>

			<div class="clearfix"></div>
			<p>&nbsp;</p>
			
			<h3>How did you do it?</h3>
			<fieldset>
				<textarea id="redactor_content" name="content" style="display: none;">
					<?php echo (isset($project)) ? $project->content : '<p>Gallia est omnis devisa in partes tres...</p>'; ?>
				</textarea>			
			</fieldset>			
			<p>&nbsp;</p>
			<input type="submit" value="Save project" class="btn btn-primary">
			<?php if (Sentry::Check() && Sentry::getUser()->hasAccess('is_admin')): ?>
			<?php echo (isset($project)) ? '<button type="button" class="btn btn-danger" onclick="delete_project();">Delete project</button>' : ''; ?>
			<?php endif; ?>
		</div>
	</div>

</div>
	<?php echo Form::close(); ?>



<?php $__env->stopSection(); ?>
<?php echo $__env->make('layouts.master', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>